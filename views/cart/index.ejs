<%- include('../partials/header') %>

<!-- Load Cart CSS -->
<link rel="stylesheet" href="/css/cart.css">

<div class="cart-page">
    <div class="container">
        <h1 class="cart-page__title">üõí Gi·ªè h√†ng c·ªßa b·∫°n</h1>
        
        <% if (!cart || !cart.items || cart.items.length === 0) { %>
            <div class="cart-empty">
                <span class="cart-empty__icon">üõí</span>
                <h2 class="cart-empty__title">Gi·ªè h√†ng tr·ªëng</h2>
                <p class="cart-empty__text">Th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng ƒë·ªÉ mua s·∫Øm</p>
                <a href="/products" class="cart-empty__btn">Ti·∫øp t·ª•c mua s·∫Øm</a>
            </div>
        <% } else { %>
            <div class="cart-grid">
                <!-- Cart Items -->
                <div class="cart-items-container">
                    <!-- Select All -->
                    <div class="cart-select-all">
                        <label>
                            <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" class="cart-select-all__checkbox">
                            <span class="cart-select-all__text">Ch·ªçn t·∫•t c·∫£ (<%= cart.items.length %> s·∫£n ph·∫©m)</span>
                        </label>
                    </div>
                    
                    <!-- Items List -->
                    <div id="cartItems">
                        <% cart.items.forEach((item, index) => { %>
                            <div class="cart-item <%= index < cart.items.length - 1 ? 'cart-item--bordered' : '' %>" data-item-id="<%= item.id %>" data-price="<%= item.subtotal %>">
                                <!-- Checkbox -->
                                <div class="cart-item__checkbox-wrapper">
                                    <input type="checkbox" class="item-checkbox cart-item__checkbox" value="<%= item.id %>" data-price="<%= item.subtotal %>" onchange="updateSelectedTotal()">
                                </div>
                                
                                <!-- Image -->
                                <div class="cart-item__image">
                                    <% if (item.product_image) { %>
                                        <img src="<%= item.product_image %>" alt="<%= item.product_name %>">
                                    <% } else { %>
                                        <div class="cart-item__image-placeholder">üëï</div>
                                    <% } %>
                                </div>
                                
                                <!-- Info -->
                                <div class="cart-item__info">
                                    <a href="/products/<%= item.product_slug %>" class="cart-item__name">
                                        <%= item.product_name %>
                                    </a>
                                    <% if (item.size || item.color) { %>
                                        <p class="cart-item__variant">
                                            <% if (item.size) { %>Size: <%= item.size %><% } %>
                                            <% if (item.color) { %> | M√†u: <%= item.color %><% } %>
                                        </p>
                                    <% } %>
                                    <p class="cart-item__unit-price"><%= item.unit_price.toLocaleString('vi-VN') %>ƒë</p>
                                </div>
                                
                                <!-- Quantity -->
                                <div class="cart-item__quantity">
                                    <button onclick="updateQuantity(<%= item.id %>, <%= item.quantity - 1 %>)" class="cart-item__qty-btn">‚àí</button>
                                    <input type="number" value="<%= item.quantity %>" min="1" readonly class="cart-item__qty-input">
                                    <button onclick="updateQuantity(<%= item.id %>, <%= item.quantity + 1 %>)" class="cart-item__qty-btn">+</button>
                                </div>
                                
                                <!-- Subtotal -->
                                <div class="cart-item__subtotal">
                                    <p class="cart-item__subtotal-price"><%= item.subtotal.toLocaleString('vi-VN') %>ƒë</p>
                                </div>
                                
                                <!-- Remove -->
                                <button onclick="removeItem(<%= item.id %>)" class="cart-item__remove">√ó</button>
                            </div>
                        <% }) %>
                    </div>
                </div>
                
                <!-- Order Summary -->
                <div class="cart-summary-wrapper">
                    <div class="cart-summary">
                        <h3 class="cart-summary__title">üì¶ T·ªïng ƒë∆°n h√†ng</h3>
                        
                        <div class="cart-summary__rows">
                            <div class="cart-summary__row">
                                <span class="cart-summary__label">S·∫£n ph·∫©m ƒë√£ ch·ªçn:</span>
                                <span id="selectedCount" class="cart-summary__value">0</span>
                            </div>
                            <div class="cart-summary__row">
                                <span class="cart-summary__label">T·∫°m t√≠nh:</span>
                                <span id="selectedSubtotal" class="cart-summary__value">0ƒë</span>
                            </div>
                            <div class="cart-summary__row">
                                <span class="cart-summary__label">Ph√≠ v·∫≠n chuy·ªÉn:</span>
                                <span id="shippingFee" class="cart-summary__value">30.000ƒë</span>
                            </div>
                        </div>
                        
                        <div class="cart-summary__total">
                            <span class="cart-summary__total-label">T·ªïng c·ªông:</span>
                            <span id="selectedTotal" class="cart-summary__total-value">0ƒë</span>
                        </div>
                        
                        <button onclick="checkoutSelected()" id="checkoutBtn" disabled class="cart-summary__checkout-btn">
                            ‚ú® Thanh to√°n (<span id="checkoutCount">0</span> s·∫£n ph·∫©m)
                        </button>
                        
                        <a href="/products" class="cart-summary__continue-btn">
                            Ti·∫øp t·ª•c mua s·∫Øm
                        </a>
                    </div>
                </div>
            </div>
        <% } %>
    </div>
</div>

<script src="/js/main.js"></script>
<script src="/js/cart.js"></script>

<%- include('../partials/footer') %>
