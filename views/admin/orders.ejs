<%- include('../partials/admin-header', { currentPage: 'orders' }) %>

<div class="admin-page" style="padding: 40px 20px;">
    <div class="container">
        <h1 style="margin-bottom: 40px; color: #333;">üõí Qu·∫£n L√Ω ƒê∆°n H√†ng</h1>
        
        <% if (orders && orders.length > 0) { %>
            <div class="orders-table" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f8f9fa; border-bottom: 2px solid #eee;">
                            <th style="padding: 15px; text-align: left;">M√£ ƒê∆°n</th>
                            <th style="padding: 15px; text-align: left;">Kh√°ch H√†ng</th>
                            <th style="padding: 15px; text-align: right;">T·ªïng Ti·ªÅn</th>
                            <th style="padding: 15px; text-align: center;">Thanh To√°n</th>
                            <th style="padding: 15px; text-align: center;">Tr·∫°ng Th√°i</th>
                            <th style="padding: 15px; text-align: center;">Ng√†y</th>
                            <th style="padding: 15px; text-align: center;">Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% orders.forEach(order => { %>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 15px;"><strong><%= order.order_code %></strong></td>
                                <td style="padding: 15px;"><%= order.user_name || order.recipient_name || 'N/A' %></td>
                                <td style="padding: 15px; text-align: right; font-weight: 600; color: #d32f2f;">
                                    <%= (order.final_amount || order.total_amount || 0).toLocaleString('vi-VN') %>ƒë
                                </td>
                                <td style="padding: 15px; text-align: center;">
                                    <span style="padding: 4px 10px; border-radius: 12px; font-size: 12px; background: <%= order.payment_status === 'paid' ? '#e8f5e9' : '#fff3e0' %>; color: <%= order.payment_status === 'paid' ? '#2e7d32' : '#ef6c00' %>;">
                                        <%= order.payment_status === 'paid' ? 'ƒê√£ TT' : 'Ch∆∞a TT' %>
                                    </span>
                                </td>
                                <td style="padding: 15px; text-align: center;">
                                    <select onchange="updateOrderStatus('<%= order.id %>', this.value)" style="padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="pending" <%= order.status === 'pending' ? 'selected' : '' %>>Ch·ªù x·ª≠ l√Ω</option>
                                        <option value="confirmed" <%= order.status === 'confirmed' ? 'selected' : '' %>>ƒê√£ x√°c nh·∫≠n</option>
                                        <option value="shipping" <%= order.status === 'shipping' ? 'selected' : '' %>>ƒêang giao</option>
                                        <option value="delivered" <%= order.status === 'delivered' ? 'selected' : '' %>>ƒê√£ giao</option>
                                        <option value="cancelled" <%= order.status === 'cancelled' ? 'selected' : '' %>>ƒê√£ h·ªßy</option>
                                    </select>
                                </td>
                                <td style="padding: 15px; text-align: center;"><%= new Date(order.created_at).toLocaleDateString('vi-VN') %></td>
                                <td style="padding: 15px; text-align: center;">
                                    <button onclick="viewOrderDetail('<%= order.id %>')" style="padding: 6px 12px; font-size: 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Chi ti·∫øt</button>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        <% } else { %>
            <div style="text-align: center; padding: 60px; background: white; border-radius: 12px;">
                <span style="font-size: 64px;">üì≠</span>
                <h3 style="margin: 20px 0 10px 0; color: #333;">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</h3>
            </div>
        <% } %>
    </div>
</div>

<script>
async function updateOrderStatus(orderId, status) {
    try {
        const response = await fetch(`/admin/orders/${orderId}/status`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ status })
        });
        if (response.ok) {
            alert('C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng!');
        } else {
            alert('L·ªói c·∫≠p nh·∫≠t tr·∫°ng th√°i');
        }
    } catch (error) {
        alert('L·ªói: ' + error.message);
    }
}

function viewOrderDetail(orderId) {
    alert('Chi ti·∫øt ƒë∆°n h√†ng #' + orderId + ' - Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn');
}
</script>

<%- include('../partials/admin-footer') %>
