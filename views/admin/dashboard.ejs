<%- include('../partials/admin-header', { currentPage: 'dashboard' }) %>

<div class="admin-page">
    <div class="container">
        <!-- Page Header -->
        <div class="admin-page-header">
            <div class="admin-page-header__left">
                <h1>Dashboard</h1>
                <p>Tổng quan hoạt động kinh doanh</p>
            </div>
            <div class="admin-page-header__actions">
                <button class="admin-btn admin-btn--primary" onclick="refreshDashboard()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"/>
                        <polyline points="1 20 1 14 7 14"/>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                    </svg>
                    Làm mới
                </button>
            </div>
        </div>

        <% if (stats) { %>
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card stat-card--purple">
                    <div class="stat-card__icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"/>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                    </div>
                    <div class="stat-card__content">
                        <h3 class="stat-card__label">Tổng Doanh Thu</h3>
                        <p class="stat-card__value"><%= (stats.total_revenue || 0).toLocaleString('vi-VN') %>đ</p>
                    </div>
                </div>

                <div class="stat-card stat-card--pink">
                    <div class="stat-card__icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                    </div>
                    <div class="stat-card__content">
                        <h3 class="stat-card__label">Doanh Thu Hôm Nay</h3>
                        <p class="stat-card__value"><%= (stats.today_revenue || 0).toLocaleString('vi-VN') %>đ</p>
                    </div>
                </div>

                <div class="stat-card stat-card--blue">
                    <div class="stat-card__icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                            <line x1="3" y1="6" x2="21" y2="6"/>
                            <path d="M16 10a4 4 0 0 1-8 0"/>
                        </svg>
                    </div>
                    <div class="stat-card__content">
                        <h3 class="stat-card__label">Tổng Đơn Hàng</h3>
                        <p class="stat-card__value"><%= stats.total_orders || 0 %></p>
                    </div>
                </div>

                <div class="stat-card stat-card--green">
                    <div class="stat-card__icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                    </div>
                    <div class="stat-card__content">
                        <h3 class="stat-card__label">Đơn Chờ Xử Lý</h3>
                        <p class="stat-card__value"><%= stats.pending_orders || 0 %></p>
                    </div>
                </div>
            </div>

            <!-- Additional Stats Row -->
            <div class="stats-grid" style="margin-top: 24px;">
                <div class="stat-card">
                    <div class="stat-card__icon" style="background: rgba(59, 130, 246, 0.1); color: var(--admin-accent);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                    </div>
                    <div class="stat-card__content">
                        <h3 class="stat-card__label">Tổng Người Dùng</h3>
                        <p class="stat-card__value"><%= stats.total_users || 0 %></p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card__icon" style="background: rgba(139, 92, 246, 0.1); color: #8b5cf6;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                            <line x1="12" y1="22.08" x2="12" y2="12"/>
                        </svg>
                    </div>
                    <div class="stat-card__content">
                        <h3 class="stat-card__label">Tổng Sản Phẩm</h3>
                        <p class="stat-card__value"><%= stats.total_products || 0 %></p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card__icon" style="background: rgba(16, 185, 129, 0.1); color: var(--admin-success);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                    </div>
                    <div class="stat-card__content">
                        <h3 class="stat-card__label">Đơn Hoàn Thành</h3>
                        <p class="stat-card__value"><%= stats.completed_orders || 0 %></p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card__icon" style="background: rgba(239, 68, 68, 0.1); color: var(--admin-danger);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                    </div>
                    <div class="stat-card__content">
                        <h3 class="stat-card__label">Đơn Đã Hủy</h3>
                        <p class="stat-card__value"><%= stats.cancelled_orders || 0 %></p>
                    </div>
                </div>
            </div>
        <% } %>

        <!-- Recent Orders -->
        <% if (recentOrders && recentOrders.length > 0) { %>
            <div class="admin-section" style="margin-top: 32px;">
                <div class="admin-section__header">
                    <h3 class="admin-section__title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                            <line x1="3" y1="6" x2="21" y2="6"/>
                            <path d="M16 10a4 4 0 0 1-8 0"/>
                        </svg>
                        Đơn Hàng Gần Đây
                    </h3>
                    <a href="/admin/orders" class="admin-btn admin-btn--ghost">
                        Xem tất cả
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </a>
                </div>
                <div class="admin-table-wrapper">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Mã Đơn</th>
                                <th>Khách Hàng</th>
                                <th class="text-right">Tổng Tiền</th>
                                <th class="text-center">Trạng Thái</th>
                                <th class="text-center">Ngày</th>
                                <th class="text-center">Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% recentOrders.forEach(order => { %>
                                <tr>
                                    <td>
                                        <a href="/admin/orders/<%= order.id %>" class="admin-table__link">
                                            <strong><%= order.order_code %></strong>
                                        </a>
                                    </td>
                                    <td>
                                        <div class="order-customer">
                                            <span class="order-customer__name"><%= order.user_name || order.recipient_name || 'N/A' %></span>
                                        </div>
                                    </td>
                                    <td class="text-right">
                                        <span class="admin-table__price"><%= (order.final_amount || 0).toLocaleString('vi-VN') %>đ</span>
                                    </td>
                                    <td class="text-center">
                                        <%
                                            let statusClass = '';
                                            let statusText = '';
                                            switch(order.status) {
                                                case 'pending':
                                                    statusClass = 'admin-table__badge--pending';
                                                    statusText = 'Chờ xử lý';
                                                    break;
                                                case 'confirmed':
                                                    statusClass = 'admin-table__badge--processing';
                                                    statusText = 'Đã xác nhận';
                                                    break;
                                                case 'shipping':
                                                    statusClass = 'admin-table__badge--shipped';
                                                    statusText = 'Đang giao';
                                                    break;
                                                case 'delivered':
                                                    statusClass = 'admin-table__badge--delivered';
                                                    statusText = 'Đã giao';
                                                    break;
                                                case 'cancelled':
                                                    statusClass = 'admin-table__badge--cancelled';
                                                    statusText = 'Đã hủy';
                                                    break;
                                                default:
                                                    statusClass = '';
                                                    statusText = order.status;
                                            }
                                        %>
                                        <span class="admin-table__badge <%= statusClass %>"><%= statusText %></span>
                                    </td>
                                    <td class="text-center">
                                        <span class="order-date"><%= new Date(order.created_at).toLocaleDateString('vi-VN') %></span>
                                    </td>
                                    <td class="text-center">
                                        <a href="/admin/orders/<%= order.id %>" class="admin-btn admin-btn--edit" title="Xem chi tiết">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                                <circle cx="12" cy="12" r="3"/>
                                            </svg>
                                        </a>
                                    </td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        <% } else { %>
            <div class="admin-empty" style="margin-top: 32px;">
                <div class="admin-empty__icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <path d="M16 10a4 4 0 0 1-8 0"/>
                    </svg>
                </div>
                <h3 class="admin-empty__title">Chưa có đơn hàng nào</h3>
                <p class="admin-empty__text">Hệ thống đang hoạt động bình thường. Đơn hàng mới sẽ xuất hiện tại đây.</p>
            </div>
        <% } %>

        <!-- Quick Actions -->
        <div class="admin-section" style="margin-top: 32px;">
            <h3 class="admin-section__title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
                Thao Tác Nhanh
            </h3>
            <div class="quick-actions">
                <a href="/admin/products" class="quick-action">
                    <div class="quick-action__icon quick-action__icon--blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        </svg>
                    </div>
                    <span>Thêm Sản Phẩm</span>
                </a>
                <a href="/admin/orders" class="quick-action">
                    <div class="quick-action__icon quick-action__icon--purple">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                            <line x1="3" y1="6" x2="21" y2="6"/>
                        </svg>
                    </div>
                    <span>Quản Lý Đơn Hàng</span>
                </a>
                <a href="/admin/sales" class="quick-action">
                    <div class="quick-action__icon quick-action__icon--pink">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                            <line x1="7" y1="7" x2="7.01" y2="7"/>
                        </svg>
                    </div>
                    <span>Tạo Khuyến Mãi</span>
                </a>
                <a href="/admin/banners" class="quick-action">
                    <div class="quick-action__icon quick-action__icon--green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21 15 16 10 5 21"/>
                        </svg>
                    </div>
                    <span>Quản Lý Banner</span>
                </a>
            </div>
        </div>
    </div>
</div>

<style>
/* Page Header */
.admin-page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
}

.admin-page-header__left h1 {
    font-size: 28px;
    font-weight: 700;
    color: var(--admin-text-primary);
    margin: 0 0 4px 0;
}

.admin-page-header__left p {
    font-size: 14px;
    color: var(--admin-text-secondary);
    margin: 0;
}

/* Stat Card with Icon */
.stat-card__icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
}

.stat-card--purple .stat-card__icon {
    background: rgba(139, 92, 246, 0.15);
    color: #8b5cf6;
}

.stat-card--pink .stat-card__icon {
    background: rgba(236, 72, 153, 0.15);
    color: #ec4899;
}

.stat-card--blue .stat-card__icon {
    background: rgba(59, 130, 246, 0.15);
    color: #3b82f6;
}

.stat-card--green .stat-card__icon {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
}

/* Section Header */
.admin-section__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

/* Order Customer */
.order-customer {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.order-customer__name {
    font-weight: 500;
    color: var(--admin-text-primary);
}

/* Order Date */
.order-date {
    font-size: 13px;
    color: var(--admin-text-secondary);
}

/* Quick Actions */
.quick-actions {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
}

.quick-action {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 24px;
    background: var(--admin-card-bg);
    border: 1px solid var(--admin-border);
    border-radius: 12px;
    text-decoration: none;
    color: var(--admin-text-primary);
    transition: all 0.2s;
}

.quick-action:hover {
    transform: translateY(-4px);
    box-shadow: var(--admin-shadow-md);
    border-color: var(--admin-accent);
}

.quick-action__icon {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.quick-action__icon--blue {
    background: rgba(59, 130, 246, 0.1);
    color: #3b82f6;
}

.quick-action__icon--purple {
    background: rgba(139, 92, 246, 0.1);
    color: #8b5cf6;
}

.quick-action__icon--pink {
    background: rgba(236, 72, 153, 0.1);
    color: #ec4899;
}

.quick-action__icon--green {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
}

.quick-action span {
    font-size: 14px;
    font-weight: 500;
}

/* Admin Button Ghost */
.admin-btn--ghost {
    background: transparent;
    color: var(--admin-text-secondary);
    border: 1px solid var(--admin-border);
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.admin-btn--ghost:hover {
    background: var(--admin-bg);
    color: var(--admin-text-primary);
}

/* Responsive */
@media (max-width: 1024px) {
    .quick-actions {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .admin-page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }

    .quick-actions {
        grid-template-columns: 1fr;
    }

    .admin-section__header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
}
</style>

<script>
function refreshDashboard() {
    location.reload();
}
</script>

<%- include('../partials/admin-footer') %>
