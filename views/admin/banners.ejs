<%- include('../partials/admin-header', { currentPage: 'banners' }) %>

<div class="admin-page" style="padding: 40px 20px;">
    <div class="container">
        <h1 style="margin-bottom: 40px; color: #333;">üñºÔ∏è Qu·∫£n L√Ω Banners</h1>
        
        <!-- Add Banner Form -->
        <div style="background: white; border-radius: 12px; padding: 30px; margin-bottom: 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <h3 style="margin: 0 0 20px 0;">‚ûï Th√™m Banner M·ªõi</h3>
            <form action="/admin/banners" method="POST" enctype="multipart/form-data">
                <div style="display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">Ti√™u ƒë·ªÅ</label>
                        <input type="text" name="title" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">Ph·ª• ƒë·ªÅ</label>
                        <input type="text" name="subtitle" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">Link URL</label>
                        <input type="text" name="link_url" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">H√¨nh ·∫£nh</label>
                        <input type="file" name="image" accept="image/*" style="padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
                <button type="submit" style="margin-top: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 6px; cursor: pointer; font-weight: 600;">Th√™m Banner</button>
            </form>
        </div>
        
        <% if (banners && banners.length > 0) { %>
            <div style="display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                <% banners.forEach(banner => { %>
                    <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: relative;">
                        <% if (banner.image_url) { %>
                            <div style="height: 150px; overflow: hidden;">
                                <img src="<%= banner.image_url %>" alt="<%= banner.title %>" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                        <% } else { %>
                            <div style="height: 150px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">
                                üñºÔ∏è
                            </div>
                        <% } %>
                        <div style="padding: 20px;">
                            <h4 style="margin: 0 0 10px 0;"><%= banner.title %></h4>
                            <p style="margin: 0 0 15px 0; color: #666; font-size: 14px;"><%= banner.subtitle || 'Kh√¥ng c√≥ ph·ª• ƒë·ªÅ' %></p>
                            <button onclick="deleteBanner(<%= banner.id %>)" style="padding: 8px 16px; font-size: 12px; background: #ffebee; color: #c62828; border: none; border-radius: 4px; cursor: pointer;">üóëÔ∏è X√≥a Banner</button>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <div style="text-align: center; padding: 60px; background: white; border-radius: 12px;">
                <span style="font-size: 64px;">üñºÔ∏è</span>
                <h3 style="margin: 20px 0 10px 0; color: #333;">Ch∆∞a c√≥ banner n√†o</h3>
            </div>
        <% } %>
    </div>
</div>

<!-- Toast Notification Container -->
<div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 10000;"></div>

<!-- Confirm Modal Dialog -->
<div id="confirmModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10001; align-items: center; justify-content: center;">
    <div style="background: white; border-radius: 16px; padding: 30px; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.3); animation: modalFadeIn 0.2s ease;">
        <div style="font-size: 48px; margin-bottom: 15px;">‚ö†Ô∏è</div>
        <h3 id="confirmTitle" style="margin: 0 0 10px 0; font-size: 20px; color: #333;">X√°c nh·∫≠n</h3>
        <p id="confirmMessage" style="margin: 0 0 25px 0; color: #666; font-size: 15px;">B·∫°n c√≥ ch·∫Øc mu·ªën th·ª±c hi·ªán?</p>
        <div style="display: flex; gap: 12px; justify-content: center;">
            <button id="confirmYes" style="flex: 1; padding: 12px 24px; background: linear-gradient(135deg, #f44336, #d32f2f); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">X√°c nh·∫≠n</button>
            <button id="confirmNo" style="flex: 1; padding: 12px 24px; background: #f5f5f5; color: #333; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">H·ªßy</button>
        </div>
    </div>
</div>

<script>
// Toast notification function
function showToast(message, type = 'success') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    
    const bgColor = type === 'success' ? 'linear-gradient(135deg, #4caf50, #45a049)' : 
                    type === 'error' ? 'linear-gradient(135deg, #f44336, #d32f2f)' : 
                    'linear-gradient(135deg, #2196f3, #1976d2)';
    const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
    
    toast.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px; background: ${bgColor}; color: white; padding: 16px 24px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.25); margin-bottom: 10px; min-width: 280px; animation: slideInRight 0.3s ease;">
            <span style="font-size: 20px;">${icon}</span>
            <span style="font-size: 14px; font-weight: 500;">${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" style="margin-left: auto; background: none; border: none; color: white; font-size: 18px; cursor: pointer; opacity: 0.8;">√ó</button>
        </div>
    `;
    
    container.appendChild(toast);
    
    setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => toast.remove(), 300);
    }, 4000);
}

// Custom confirm modal
function showConfirm(message, title = 'X√°c nh·∫≠n') {
    return new Promise((resolve) => {
        const modal = document.getElementById('confirmModal');
        document.getElementById('confirmTitle').textContent = title;
        document.getElementById('confirmMessage').textContent = message;
        modal.style.display = 'flex';
        
        document.getElementById('confirmYes').onclick = () => {
            modal.style.display = 'none';
            resolve(true);
        };
        document.getElementById('confirmNo').onclick = () => {
            modal.style.display = 'none';
            resolve(false);
        };
    });
}

async function deleteBanner(bannerId) {
    const confirmed = await showConfirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a banner n√†y?', 'X√≥a Banner');
    if (!confirmed) return;
    
    try {
        const response = await fetch(`/admin/banners/${bannerId}`, {
            method: 'DELETE',
            credentials: 'same-origin'
        });
        
        if (response.ok) {
            showToast('ƒê√£ x√≥a banner th√†nh c√¥ng!', 'success');
            setTimeout(() => location.reload(), 1500);
        } else {
            const result = await response.json();
            showToast('L·ªói: ' + (result.message || 'Kh√¥ng th·ªÉ x√≥a banner'), 'error');
        }
    } catch (error) {
        showToast('L·ªói: ' + error.message, 'error');
    }
}
</script>

<style>
@keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
@keyframes slideOutRight {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
}
@keyframes modalFadeIn {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}
</style>

<%- include('../partials/admin-footer') %>

