<%- include('../partials/admin-header', { currentPage: 'banners' }) %>

<div class="admin-page">
    <div class="container">
        <!-- Page Header -->
        <div class="admin-page-header">
            <div class="admin-page-header__left">
                <h1>Quản Lý Banners</h1>
                <p><%= banners ? banners.length : 0 %> banner</p>
            </div>
        </div>

        <!-- Add Banner Form -->
        <div class="admin-section">
            <h3 class="admin-section__title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Thêm Banner Mới
            </h3>
            <form action="/admin/banners" method="POST" enctype="multipart/form-data" class="admin-form">
                <div class="admin-form__row">
                    <div class="admin-form__group">
                        <label class="admin-form__label">Tiêu đề <span>*</span></label>
                        <input type="text" name="title" required class="admin-form__input" placeholder="VD: BST Mùa Đông 2024">
                    </div>
                    <div class="admin-form__group">
                        <label class="admin-form__label">Phụ đề</label>
                        <input type="text" name="subtitle" class="admin-form__input" placeholder="VD: Giảm giá lên đến 50%">
                    </div>
                </div>
                <div class="admin-form__row">
                    <div class="admin-form__group">
                        <label class="admin-form__label">Link URL</label>
                        <input type="text" name="link_url" class="admin-form__input" placeholder="VD: /products?sale=true">
                    </div>
                    <div class="admin-form__group">
                        <label class="admin-form__label">Hình ảnh</label>
                        <input type="file" name="image" accept="image/*" class="admin-form__input">
                    </div>
                </div>
                <div class="admin-form__actions">
                    <button type="submit" class="admin-btn admin-btn--primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                        Thêm Banner
                    </button>
                </div>
            </form>
        </div>

        <!-- Banners Grid -->
        <% if (banners && banners.length > 0) { %>
            <div class="banners-grid">
                <% banners.forEach((banner, index) => { %>
                    <div class="banner-card">
                        <div class="banner-card__image">
                            <% if (banner.image_url) { %>
                                <img src="<%= banner.image_url %>" alt="<%= banner.title %>">
                            <% } else { %>
                                <div class="banner-card__placeholder">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                        <circle cx="8.5" cy="8.5" r="1.5"/>
                                        <polyline points="21 15 16 10 5 21"/>
                                    </svg>
                                </div>
                            <% } %>
                            <div class="banner-card__order">#<%= index + 1 %></div>
                            <div class="banner-card__overlay">
                                <% if (banner.link_url) { %>
                                    <a href="<%= banner.link_url %>" target="_blank" class="banner-card__btn" title="Xem link">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                            <polyline points="15 3 21 3 21 9"/>
                                            <line x1="10" y1="14" x2="21" y2="3"/>
                                        </svg>
                                    </a>
                                <% } %>
                                <button onclick="deleteBanner(<%= banner.id %>)" class="banner-card__btn banner-card__btn--delete" title="Xóa banner">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="banner-card__content">
                            <h4 class="banner-card__title"><%= banner.title %></h4>
                            <% if (banner.subtitle) { %>
                                <p class="banner-card__subtitle"><%= banner.subtitle %></p>
                            <% } %>
                            <% if (banner.link_url) { %>
                                <span class="banner-card__link"><%= banner.link_url %></span>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <div class="admin-empty">
                <div class="admin-empty__icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <polyline points="21 15 16 10 5 21"/>
                    </svg>
                </div>
                <h3 class="admin-empty__title">Chưa có banner nào</h3>
                <p class="admin-empty__text">Thêm banner để hiển thị trên trang chủ.</p>
            </div>
        <% } %>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer"></div>

<!-- Confirm Modal -->
<div id="confirmModal">
    <div class="confirm-modal__content">
        <div class="confirm-modal__icon confirm-modal__icon--danger">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                <line x1="12" y1="9" x2="12" y2="13"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
        </div>
        <div class="confirm-modal__text">
            <h3 id="confirmTitle">Xóa Banner</h3>
            <p id="confirmMessage">Bạn có chắc muốn xóa banner này? Hành động không thể hoàn tác.</p>
        </div>
        <div class="confirm-modal__buttons">
            <button id="confirmNo" class="admin-btn admin-btn--ghost">Hủy</button>
            <button id="confirmYes" class="admin-btn admin-btn--danger">Xóa</button>
        </div>
    </div>
</div>

<style>
/* Page Header */
.admin-page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
}

.admin-page-header__left h1 {
    font-size: 28px;
    font-weight: 700;
    color: var(--admin-text-primary);
    margin: 0 0 4px 0;
}

.admin-page-header__left p {
    font-size: 14px;
    color: var(--admin-text-secondary);
    margin: 0;
}

/* Admin Form */
.admin-form__row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-bottom: 20px;
}

.admin-form__group {
    display: flex;
    flex-direction: column;
}

.admin-form__actions {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid var(--admin-border);
}

/* Banners Grid */
.banners-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
}

/* Banner Card */
.banner-card {
    background: var(--admin-card-bg);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: var(--admin-shadow);
    border: 1px solid var(--admin-border);
    transition: transform 0.2s, box-shadow 0.2s;
}

.banner-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--admin-shadow-md);
}

.banner-card__image {
    position: relative;
    height: 180px;
    background: var(--admin-bg);
    overflow: hidden;
}

.banner-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.banner-card__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--admin-accent) 0%, #8b5cf6 100%);
    color: white;
}

.banner-card__order {
    position: absolute;
    top: 12px;
    left: 12px;
    background: var(--admin-primary);
    color: white;
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
}

.banner-card__overlay {
    position: absolute;
    inset: 0;
    background: rgba(15, 23, 42, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    opacity: 0;
    transition: opacity 0.2s;
}

.banner-card:hover .banner-card__overlay {
    opacity: 1;
}

.banner-card__btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: white;
    color: var(--admin-text-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
}

.banner-card__btn:hover {
    transform: scale(1.1);
}

.banner-card__btn--delete {
    background: var(--admin-danger);
    color: white;
}

.banner-card__content {
    padding: 20px;
}

.banner-card__title {
    font-size: 16px;
    font-weight: 600;
    color: var(--admin-text-primary);
    margin: 0 0 6px 0;
}

.banner-card__subtitle {
    font-size: 14px;
    color: var(--admin-text-secondary);
    margin: 0 0 12px 0;
}

.banner-card__link {
    display: inline-block;
    font-size: 12px;
    color: var(--admin-accent);
    background: rgba(59, 130, 246, 0.1);
    padding: 4px 10px;
    border-radius: 4px;
    word-break: break-all;
}

/* Confirm Modal */
.confirm-modal__icon {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
}

.confirm-modal__icon--danger {
    background: rgba(239, 68, 68, 0.1);
    color: var(--admin-danger);
}

.confirm-modal__text {
    text-align: center;
    margin-bottom: 24px;
}

.confirm-modal__text h3 {
    font-size: 18px;
    font-weight: 600;
    margin: 0 0 8px 0;
    color: var(--admin-text-primary);
}

.confirm-modal__text p {
    font-size: 14px;
    color: var(--admin-text-secondary);
    margin: 0;
}

/* Admin Button Ghost */
.admin-btn--ghost {
    background: transparent;
    color: var(--admin-text-secondary);
    border: 1px solid var(--admin-border);
}

.admin-btn--ghost:hover {
    background: var(--admin-bg);
    color: var(--admin-text-primary);
}

/* Admin Button Danger */
.admin-btn--danger {
    background: var(--admin-danger);
    color: white;
}

.admin-btn--danger:hover {
    background: #dc2626;
    color: white;
}

/* Responsive */
@media (max-width: 1024px) {
    .banners-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .banners-grid {
        grid-template-columns: 1fr;
    }

    .admin-form__row {
        grid-template-columns: 1fr;
    }
}
</style>

<script src="/js/admin/banners.js"></script>

<%- include('../partials/admin-footer') %>
