<%- include('../partials/header') %>

<!-- Load User Profile CSS & JS -->
<link rel="stylesheet" href="/css/user-profile.css">

<div class="user-profile-page">
    <div class="container">
        <h1 class="user-profile-page__title">üë§ T√†i Kho·∫£n C·ªßa T√¥i</h1>
        
        <% if (user) { %>
        <div class="profile-grid">
            <!-- Sidebar with Avatar -->
            <div class="profile-sidebar">
                <div class="profile-avatar">
                    <% if (user.avatar_url) { %>
                        <img src="<%= user.avatar_url %>" alt="Avatar" class="profile-avatar__image" id="avatarImage">
                        <div class="profile-avatar__placeholder" id="avatarPlaceholder" style="display: none;">üë§</div>
                    <% } else { %>
                        <img src="" alt="Avatar" class="profile-avatar__image" id="avatarImage" style="display: none;">
                        <div class="profile-avatar__placeholder" id="avatarPlaceholder">üë§</div>
                    <% } %>
                    <label class="profile-avatar__upload" title="Thay ƒë·ªïi ·∫£nh ƒë·∫°i di·ªán">
                        <input type="file" accept="image/*" id="avatarInput">
                        <span class="profile-avatar__upload-icon">üì∑</span>
                    </label>
                </div>
                
                <h2 class="profile-sidebar__name"><%= user.full_name %></h2>
                <p class="profile-sidebar__email"><%= user.email %></p>
                <p class="profile-sidebar__joined">
                    Th√†nh vi√™n t·ª´ <%= new Date(user.created_at).toLocaleDateString('vi-VN') %>
                </p>
            </div>
            
            <!-- Main Content -->
            <div class="profile-content">
                <!-- Personal Info Section -->
                <div class="profile-section">
                    <div class="profile-section__header">
                        <span class="profile-section__icon">üìã</span>
                        <h3 class="profile-section__title">Th√¥ng tin c√° nh√¢n</h3>
                    </div>
                    
                    <form id="profileForm">
                        <div class="profile-form__grid">
                            <div class="profile-form__field">
                                <label class="profile-form__label">H·ªç v√† t√™n</label>
                                <input type="text" name="full_name" value="<%= user.full_name %>" 
                                       class="profile-form__input" required minlength="2">
                            </div>
                            <div class="profile-form__field">
                                <label class="profile-form__label">S·ªë ƒëi·ªán tho·∫°i</label>
                                <input type="tel" name="phone" value="<%= user.phone || '' %>" 
                                       class="profile-form__input" placeholder="0901234567">
                            </div>
                        </div>
                        <div class="profile-form__field">
                            <label class="profile-form__label">Ng√†y sinh</label>
                            <input type="date" name="birthday" 
                                   value="<%= user.birthday ? new Date(user.birthday).toISOString().split('T')[0] : '' %>" 
                                   class="profile-form__input">
                        </div>
                        <button type="submit" class="profile-form__submit">
                            üíæ L∆∞u thay ƒë·ªïi
                        </button>
                    </form>
                </div>
                
                <!-- Contact Info Section -->
                <div class="profile-section">
                    <div class="profile-section__header">
                        <span class="profile-section__icon">üìß</span>
                        <h3 class="profile-section__title">Th√¥ng tin li√™n h·ªá</h3>
                    </div>
                    
                    <div class="contact-info">
                        <div class="contact-info__item">
                            <div class="contact-info__left">
                                <span class="contact-info__icon">‚úâÔ∏è</span>
                                <div>
                                    <div class="contact-info__label">Email</div>
                                    <div class="contact-info__value"><%= user.email %></div>
                                </div>
                            </div>
                            <div class="contact-info__right">
                                <% if (user.email_verified) { %>
                                    <span class="verification-badge verification-badge--verified">
                                        ‚úÖ ƒê√£ x√°c th·ª±c
                                    </span>
                                <% } else { %>
                                    <span class="verification-badge verification-badge--unverified">
                                        ‚è≥ Ch∆∞a x√°c th·ª±c
                                    </span>
                                    <a href="/auth/verify-email" class="verify-btn">
                                        X√°c th·ª±c ngay
                                    </a>
                                <% } %>
                            </div>
                        </div>

                        <div class="contact-info__item">
                            <div class="contact-info__left">
                                <span class="contact-info__icon">üì±</span>
                                <div>
                                    <div class="contact-info__label">S·ªë ƒëi·ªán tho·∫°i</div>
                                    <div class="contact-info__value"><%= user.phone || 'Ch∆∞a c·∫≠p nh·∫≠t' %></div>
                                </div>
                            </div>
                            <div class="contact-info__right">
                                <% if (user.phone_verified) { %>
                                    <span class="verification-badge verification-badge--verified">
                                        ‚úÖ ƒê√£ x√°c th·ª±c
                                    </span>
                                <% } else { %>
                                    <span class="verification-badge verification-badge--unverified">
                                        ‚è≥ Ch∆∞a x√°c th·ª±c
                                    </span>
                                    <button type="button" class="verify-btn" onclick="showDevelopingAlert()">
                                        X√°c th·ª±c ngay
                                    </button>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Change Password Section -->
                <div class="profile-section">
                    <div class="profile-section__header">
                        <span class="profile-section__icon">üîí</span>
                        <h3 class="profile-section__title">ƒê·ªïi m·∫≠t kh·∫©u</h3>
                    </div>
                    
                    <div class="password-section__info">
                        üí° ƒê·ªÉ b·∫£o m·∫≠t t√†i kho·∫£n, b·∫°n c·∫ßn nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i ƒë·ªÉ thay ƒë·ªïi m·∫≠t kh·∫©u m·ªõi.
                    </div>
                    
                    <form id="passwordForm">
                        <div class="profile-form__field">
                            <label class="profile-form__label">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                            <div class="password-input-wrapper">
                                <input type="password" name="current_password"
                                       class="profile-form__input" required>
                                <button type="button" class="password-toggle" onclick="togglePassword(this)">
                                    <span class="eye-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <div class="profile-form__grid">
                            <div class="profile-form__field">
                                <label class="profile-form__label">M·∫≠t kh·∫©u m·ªõi</label>
                                <div class="password-input-wrapper">
                                    <input type="password" name="new_password"
                                           class="profile-form__input" required minlength="6">
                                    <button type="button" class="password-toggle" onclick="togglePassword(this)">
                                        <span class="eye-icon">üëÅÔ∏è</span>
                                    </button>
                                </div>
                            </div>
                            <div class="profile-form__field">
                                <label class="profile-form__label">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                                <div class="password-input-wrapper">
                                    <input type="password" name="confirm_password"
                                           class="profile-form__input" required>
                                    <button type="button" class="password-toggle" onclick="togglePassword(this)">
                                        <span class="eye-icon">üëÅÔ∏è</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="profile-form__submit">
                            üîê ƒê·ªïi m·∫≠t kh·∫©u
                        </button>
                    </form>
                </div>
            </div>
        </div>
        <% } else { %>
            <div style="text-align: center; padding: 60px; background: white; border-radius: 12px;">
                <span style="font-size: 64px;">üîí</span>
                <h3>Vui l√≤ng ƒëƒÉng nh·∫≠p</h3>
                <a href="/auth/login" class="btn btn-primary" style="margin-top: 20px;">ƒêƒÉng nh·∫≠p</a>
            </div>
        <% } %>
    </div>
</div>

<script src="/js/main.js"></script>
<script src="/js/user-profile.js"></script>

<%- include('../partials/footer') %>
