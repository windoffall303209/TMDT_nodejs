<%- include('../partials/header') %>

<!-- Load Home CSS -->
<link rel="stylesheet" href="/css/home.css">

<!-- Popup Banner - Hiển thị 1 lần khi truy cập -->
<% if (banners && banners.length > 0) { %>
<div id="popupBanner" class="popup-banner">
    <div class="popup-banner__overlay" onclick="closePopup()"></div>
    <div class="popup-banner__content">
        <button class="popup-banner__close" onclick="closePopup()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
        <% const popupBanner = banners[0]; %>
        <a href="<%= popupBanner.link_url || '/products' %>" class="popup-banner__link">
            <% if (popupBanner.image_url) { %>
                <img src="<%= popupBanner.image_url %>" alt="<%= popupBanner.title %>">
            <% } else { %>
                <div class="popup-banner__text">
                    <h2><%= popupBanner.title %></h2>
                    <% if (popupBanner.subtitle) { %>
                        <p><%= popupBanner.subtitle %></p>
                    <% } %>
                    <span class="popup-banner__btn">Khám phá ngay</span>
                </div>
            <% } %>
        </a>
    </div>
</div>
<% } %>

<!-- Hero Banner Section -->
<section class="hero">
    <div class="hero-content">
        <p class="hero-subtitle">BST Thu Đông 2024</p>
        <h1 class="hero-title">Phong Cách<br>Tối Giản</h1>
        <a href="/products" class="btn btn-primary">Khám phá ngay</a>
    </div>
    <div class="hero-image">
        <img src="https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=1200&q=80" alt="BST Thu Đông">
    </div>
</section>

<!-- Categories Section - Đưa lên trước -->
<section class="section-categories">
    <div class="container">
        <div class="section-header">
            <div>
                <h2 class="section-title">Danh mục</h2>
                <p class="section-subtitle">Khám phá theo phong cách của bạn</p>
            </div>
        </div>

        <% if (categories && categories.length > 0) { %>
            <div class="category-grid">
                <% categories.slice(0, 3).forEach(category => { %>
                    <a href="/products/category/<%= category.slug %>" class="category-card">
                        <% if (category.image_url) { %>
                            <img src="<%= category.image_url %>" alt="<%= category.name %>">
                        <% } else { %>
                            <div class="category-placeholder"></div>
                        <% } %>
                        <div class="category-info">
                            <h3><%= category.name %></h3>
                            <span class="btn-link">Khám phá</span>
                        </div>
                    </a>
                <% }) %>
            </div>
        <% } %>
    </div>
</section>

<!-- New Products Section -->
<section class="section-products">
    <div class="container">
        <div class="section-header">
            <div>
                <h2 class="section-title">Sản phẩm mới</h2>
                <p class="section-subtitle">Khám phá những thiết kế mới nhất</p>
            </div>
            <a href="/products" class="section-link">
                Xem tất cả
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </a>
        </div>

        <% if (newProducts && newProducts.length > 0) { %>
            <div class="product-grid">
                <% newProducts.slice(0, 8).forEach(product => { %>
                    <div class="product-card">
                        <a href="/products/<%= product.slug %>">
                            <div class="product-image">
                                <% if (product.sale_type) { %>
                                    <span class="product-badge sale-badge">
                                        <% if (product.sale_type === 'percentage') { %>
                                            -<%= product.sale_value %>%
                                        <% } else { %>
                                            SALE
                                        <% } %>
                                    </span>
                                <% } %>
                                <% if (product.primary_image) { %>
                                    <img class="img-primary" src="<%= product.primary_image %>" alt="<%= product.name %>">
                                    <img class="img-secondary" src="<%= product.primary_image %>" alt="<%= product.name %>">
                                <% } else { %>
                                    <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:var(--gray-100);color:var(--gray-400);">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                            <circle cx="8.5" cy="8.5" r="1.5"/>
                                            <polyline points="21,15 16,10 5,21"/>
                                        </svg>
                                    </div>
                                <% } %>
                                <button class="quick-add-btn" onclick="addToCart(event, <%= product.id %>)">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                                        <line x1="3" y1="6" x2="21" y2="6"/>
                                        <path d="M16 10a4 4 0 0 1-8 0"/>
                                    </svg>
                                    Thêm vào giỏ
                                </button>
                            </div>
                            <div class="product-info">
                                <h3 class="product-name"><%= product.name %></h3>
                                <div class="product-price">
                                    <% if (product.final_price && product.final_price < product.price) { %>
                                        <span class="price-original"><%= product.price.toLocaleString('vi-VN') %>đ</span>
                                        <span class="price-sale"><%= product.final_price.toLocaleString('vi-VN') %>đ</span>
                                    <% } else { %>
                                        <span class="price-current"><%= product.price.toLocaleString('vi-VN') %>đ</span>
                                    <% } %>
                                </div>
                            </div>
                        </a>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <div class="empty-state">
                <p>Chưa có sản phẩm. <a href="/admin">Đi tới Admin</a> để thêm sản phẩm.</p>
            </div>
        <% } %>
    </div>
</section>

<!-- Best Sellers Section -->
<% if (bestSellers && bestSellers.length > 0) { %>
<section class="section-products">
    <div class="container">
        <div class="section-header">
            <div>
                <h2 class="section-title">Bán chạy nhất</h2>
                <p class="section-subtitle">Sản phẩm được yêu thích</p>
            </div>
            <a href="/products?sort=sold_count" class="section-link">
                Xem tất cả
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </a>
        </div>

        <div class="product-grid">
            <% bestSellers.slice(0, 4).forEach(product => { %>
                <div class="product-card">
                    <a href="/products/<%= product.slug %>">
                        <div class="product-image">
                            <% if (product.sale_type) { %>
                                <span class="product-badge sale-badge">
                                    <% if (product.sale_type === 'percentage') { %>
                                        -<%= product.sale_value %>%
                                    <% } else { %>
                                        SALE
                                    <% } %>
                                </span>
                            <% } %>
                            <% if (product.primary_image) { %>
                                <img class="img-primary" src="<%= product.primary_image %>" alt="<%= product.name %>">
                                <img class="img-secondary" src="<%= product.primary_image %>" alt="<%= product.name %>">
                            <% } else { %>
                                <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:var(--gray-100);color:var(--gray-400);">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                        <circle cx="8.5" cy="8.5" r="1.5"/>
                                        <polyline points="21,15 16,10 5,21"/>
                                    </svg>
                                </div>
                            <% } %>
                            <button class="quick-add-btn" onclick="addToCart(event, <%= product.id %>)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <path d="M16 10a4 4 0 0 1-8 0"/>
                                </svg>
                                Thêm vào giỏ
                            </button>
                        </div>
                        <div class="product-info">
                            <h3 class="product-name"><%= product.name %></h3>
                            <div class="product-price">
                                <% if (product.final_price && product.final_price < product.price) { %>
                                    <span class="price-original"><%= product.price.toLocaleString('vi-VN') %>đ</span>
                                    <span class="price-sale"><%= product.final_price.toLocaleString('vi-VN') %>đ</span>
                                <% } else { %>
                                    <span class="price-current"><%= product.price.toLocaleString('vi-VN') %>đ</span>
                                <% } %>
                            </div>
                        </div>
                    </a>
                </div>
            <% }) %>
        </div>
    </div>
</section>
<% } %>

<!-- Features Section -->
<section class="section-features">
    <div class="container">
        <div class="features-grid">
            <div class="feature-item">
                <div class="feature-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="1" y="3" width="15" height="13"/>
                        <polygon points="16,8 20,10.5 20,5.5"/>
                        <line x1="1" y1="10" x2="16" y2="10"/>
                    </svg>
                </div>
                <h4>Miễn phí vận chuyển</h4>
                <p>Cho đơn hàng từ 500.000đ</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M21 12a9 9 0 1 1-9-9"/>
                        <path d="M21 3v6h-6"/>
                    </svg>
                </div>
                <h4>Đổi trả 30 ngày</h4>
                <p>Miễn phí đổi trả trong 30 ngày</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                </div>
                <h4>Thanh toán an toàn</h4>
                <p>Bảo mật 100% thông tin</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                    </svg>
                </div>
                <h4>Hỗ trợ 24/7</h4>
                <p>Hotline: 1900 123 456</p>
            </div>
        </div>
    </div>
</section>

<script src="/js/home.js"></script>

<%- include('../partials/footer') %>
